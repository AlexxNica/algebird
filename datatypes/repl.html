<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Algebird</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Abstract Algebra for Scala." /><meta name="author" content="Algebird's contributors" /><meta name="og:image" content="/algebird/img/poster.png" /><meta name="og:title" content="Algebird" /><meta name="og:site_name" content="Algebird" /><meta name="og:url" content="http://sritchie.github.io/algebird" /><meta name="og:type" content="website" /><meta name="og:description" content="Abstract Algebra for Scala." /><meta name="twitter:image" content="/algebird/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/algebird/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/atom-one-light.min.css" /><link rel="stylesheet" href="/algebird/css/style.css" /><link rel="stylesheet" href="/algebird/css/palette.css" /><link rel="stylesheet" href="/algebird/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/algebird/" class="brand"><div class="brand-wrapper" style="background:url('/algebird/img/sidebar_brand.png') no-repeat"><span>Algebird</span></div></a></li><li><a href="/algebird/datatypes.html" class="">Data Types</a></li><li><a href="/algebird/datatypes/repl.html" class=" active ">Learning Algebird at the REPL</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/sritchie/algebird"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/sritchie/algebird"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Algebird Abstract Algebra for Scala.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Algebird Abstract Algebra for Scala.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="sritchie" data-github-repo="algebird"><div class="content-wrapper"><section><h1 id="learning-algebird-monoids-at-the-repl">Learning Algebird Monoids at the REPL</h1>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#prelim">Preliminaries</a></li>
  <li><a href="#max">Max</a></li>
  <li><a href="#hll">Hyperloglog</a></li>
  <li><a href="#bloom">Bloom Filter</a></li>
  <li><a href="#qtree">QTree</a></li>
  <li><a href="#cms">Count Min Sketch</a></li>
  <li><a href="#decayed_value">Decayed Value (aka. moving average)</a></li>
  <li><a href="#sketch_map">Sketch Map</a></li>
  <li><a href="#min">Min</a></li>
  <li><a href="#general">General - Adding and Multiplication of collections</a></li>
</ul>

<h2 id="a-idoverview-hrefoverviewa-overview"><a id="overview" href="#overview"></a> Overview</h2>

<p>The goal of this page is to show you how easy it is to learn and experiment with Algebird data structures with a REPL. Most of the examples are taken from Algebird tests.</p>

<p>It is helpful to have a conceptual understanding of Algebird. Check out the tutorials at <a href="/algebird/resources_for_learners.html">Resources for Learners</a>.</p>

<h2 id="a-idprelim-hrefprelima-preliminaries"><a id="prelim" href="#prelim"></a> Preliminaries</h2>

<p>Clone the repository:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/twitter/algebird.git
$ cd algebird
$ ./sbt "project algebird-core" console
</code></pre>
</div>

<p>Import algebird:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird._</span>
</code></pre>
</div>

<h2 id="a-idmax-hrefmaxa-max"><a id="max" href="#max"></a> Max</h2>

<p>Example from <a href="http://www.michael-noll.com/blog/2013/12/02/twitter-algebird-monoid-monad-for-large-scala-data-analytics/">http://www.michael-noll.com/blog/2013/12/02/twitter-algebird-monoid-monad-for-large-scala-data-analytics/</a></p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Max</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">numFollowers</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Ordered</span><span class="o">[</span><span class="kt">TwitterUser</span><span class="o">]</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="k">def</span> <span class="n">compare</span><span class="o">(</span><span class="n">that</span><span class="k">:</span> <span class="kt">TwitterUser</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
     <span class="o">|</span>     <span class="k">val</span> <span class="n">c</span> <span class="k">=</span> <span class="k">this</span><span class="o">.</span><span class="n">numFollowers</span> <span class="o">-</span> <span class="n">that</span><span class="o">.</span><span class="n">numFollowers</span>
     <span class="o">|</span>     <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">compareTo</span><span class="o">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="o">)</span> <span class="k">else</span> <span class="n">c</span>
     <span class="o">|</span>   <span class="o">}</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">TwitterUser</span>
</code></pre>
</div>

<p>Let’s have a popularity contest on Twitter.  The user with the most followers wins!</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">barackobama</span> <span class="k">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="s">"BarackObama"</span><span class="o">,</span> <span class="mi">40267391</span><span class="o">)</span>
<span class="n">barackobama</span><span class="k">:</span> <span class="kt">TwitterUser</span> <span class="o">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="nc">BarackObama</span><span class="o">,</span><span class="mi">40267391</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">katyperry</span> <span class="k">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="s">"katyperry"</span><span class="o">,</span> <span class="mi">48013573</span><span class="o">)</span>
<span class="n">katyperry</span><span class="k">:</span> <span class="kt">TwitterUser</span> <span class="o">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="n">katyperry</span><span class="o">,</span><span class="mi">48013573</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">ladygaga</span> <span class="k">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="s">"ladygaga"</span><span class="o">,</span> <span class="mi">40756470</span><span class="o">)</span>
<span class="n">ladygaga</span><span class="k">:</span> <span class="kt">TwitterUser</span> <span class="o">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="n">ladygaga</span><span class="o">,</span><span class="mi">40756470</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">miguno</span> <span class="k">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="s">"miguno"</span><span class="o">,</span> <span class="mi">731</span><span class="o">)</span> <span class="c1">// I participate, too.  Olympic spirit!
</span><span class="n">miguno</span><span class="k">:</span> <span class="kt">TwitterUser</span> <span class="o">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="n">miguno</span><span class="o">,</span><span class="mi">731</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">taylorswift</span> <span class="k">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="s">"taylorswift13"</span><span class="o">,</span> <span class="mi">37125055</span><span class="o">)</span>
<span class="n">taylorswift</span><span class="k">:</span> <span class="kt">TwitterUser</span> <span class="o">=</span> <span class="nc">TwitterUser</span><span class="o">(</span><span class="n">taylorswift13</span><span class="o">,</span><span class="mi">37125055</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">winner</span><span class="k">:</span> <span class="kt">Max</span><span class="o">[</span><span class="kt">TwitterUser</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Max</span><span class="o">(</span><span class="n">barackobama</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="n">katyperry</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="n">ladygaga</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="n">miguno</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Max</span><span class="o">(</span><span class="n">taylorswift</span><span class="o">)</span>
<span class="n">winner</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Max</span><span class="o">[</span><span class="kt">TwitterUser</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Max</span><span class="o">(</span><span class="nc">TwitterUser</span><span class="o">(</span><span class="n">katyperry</span><span class="o">,</span><span class="mi">48013573</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">assert</span><span class="o">(</span><span class="n">winner</span><span class="o">.</span><span class="n">get</span> <span class="o">==</span> <span class="n">katyperry</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="a-idhll-hrefhlla-hyperloglog"><a id="hll" href="#hll"></a> Hyperloglog</h2>

<p>HyperLogLog is an approximation algorithm that estimates the number of distinct elements in a multiset using a constant amount of memory. (See https://en.wikipedia.org/wiki/HyperLogLog)</p>

<p>In Algebird, the HLL class can be used like a set. You can create an HLL from an element, and you can combine HLLs using the <code class="highlighter-rouge">+</code> operation, which is like set union. Like most structures in Algebird, HLLs form a monoid, where set union (<code class="highlighter-rouge">+</code>) is the addition operation.</p>

<p>Unlike a normal set, HLL cannot lookup whether elements are in the set. If you want to do this, consider using a BloomFilter, which can check elements for set membership, but is less memory-efficient than a HLL.</p>

<blockquote>
  <p>Note: Internally, HLL represents its elements using hashes, which are internally represented as <code class="highlighter-rouge">Array[Byte]</code>. For this reason, some HLL methods take an <code class="highlighter-rouge">Array[Byte]</code>, assuming that the user will convert the object to an <code class="highlighter-rouge">Array[Byte]</code>. However, to make using the HLLs easier, there are also generic methods that take any type <code class="highlighter-rouge">K</code> as long as there’s evidence of a <code class="highlighter-rouge">Hash128[K]</code>, which represents a 128-bit hash function for objects of type <code class="highlighter-rouge">K</code>.</p>
</blockquote>

<p>HLLs cannot be instantiated directly. Instead, you must create them using one of the following strategies:</p>

<h3 id="hyperloglogmonoid">HyperLogLogMonoid</h3>

<p>The <code class="highlighter-rouge">HyperLogLogMonoid</code> class is the simplest way to create HLLs. <code class="highlighter-rouge">HyperLogLogMonoid</code> is quite barebones, so, in most situations, it makes sense to use the <code class="highlighter-rouge">HyperLogLogAggregator</code> methods mentioned below.</p>

<h4 id="step-1-create-a-hyperloglogmonoid">Step 1: Create a HyperLogLogMonoid</h4>

<p>The HyperLogLogMonoid constructor takes an Int <code class="highlighter-rouge">bits</code>, which represents the number of bits of the hash function that the HLL uses. The more bits you use, the more space the HLLs will take up, and the more precise your estimates will be. For a better understanding of the space-to-accuracy trade-off, see <a href="https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/HyperLogLog.scala#L197">this table</a> or use one of the other strategies mentioned below, which allow you to specify the desired error.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">hllMonoid</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HyperLogLogMonoid</span><span class="o">(</span><span class="n">bits</span> <span class="k">=</span> <span class="mi">4</span><span class="o">)</span>
<span class="n">hllMonoid</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HyperLogLogMonoid</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">HyperLogLogMonoid</span><span class="k">@</span><span class="mi">59</span><span class="n">a174ec</span>
</code></pre>
</div>

<h4 id="step-2-create-hlls-from-your-data">Step 2: Create HLLs from your data</h4>

<p>HyperLogLogMonoid has a <code class="highlighter-rouge">create</code> method which takes a hashed element (as a <code class="highlighter-rouge">Array[Byte]</code>) and returns an <code class="highlighter-rouge">HLL</code> which represents a set containing the given element.</p>

<p>We can create an HLL containing a list of elements by creating HLLs for each element using the <code class="highlighter-rouge">create</code> method, and combining the elements using the HyperLogLogMonoid’s <code class="highlighter-rouge">sum</code> method.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.HyperLogLog.int2Bytes</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.HyperLogLog.int2Bytes</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">hlls</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">hllMonoid</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">}</span>
<span class="n">hlls</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">com.twitter.algebird.HLL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">13</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">13</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">4</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">4</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">12</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">12</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">combinedHLL</span> <span class="k">=</span> <span class="n">hllMonoid</span><span class="o">.</span><span class="n">sum</span><span class="o">(</span><span class="n">hlls</span><span class="o">)</span>
<span class="n">combinedHLL</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HLL</span> <span class="o">=</span> <span class="nc">DenseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Bytes</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">))</span>
</code></pre>
</div>

<p>Note that we were able to call <code class="highlighter-rouge">hllMonoid.create</code> on an <code class="highlighter-rouge">Int</code> because we imported the implicit conversion <code class="highlighter-rouge">int2Bytes</code> that converts an <code class="highlighter-rouge">Int</code> into a <code class="highlighter-rouge">Array[Byte]</code>.</p>

<h4 id="step-3-approximating-set-cardinality-using-an-hll">Step 3: Approximating set cardinality using an HLL</h4>

<p>We can use the <code class="highlighter-rouge">sizeOf</code> method to estimate the approximate number of distinct elements in the multiset.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">approxSizeOf</span> <span class="k">=</span> <span class="n">hllMonoid</span><span class="o">.</span><span class="n">sizeOf</span><span class="o">(</span><span class="n">combinedHLL</span><span class="o">)</span>
<span class="n">approxSizeOf</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Approximate</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Approximate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">9</span><span class="o">,</span><span class="mf">0.9972</span><span class="o">)</span>
</code></pre>
</div>

<h3 id="hyperloglogaggregator">HyperLogLogAggregator</h3>

<p>The <code class="highlighter-rouge">HyperLogLogAggregator</code> object contains some methods that make it easy to instantiate Algebird Aggregators that internally use HLLs.</p>

<p>We will only mention the generic Aggregators here. The generic aggregators require that we have an implicit <code class="highlighter-rouge">Hash128[K]</code> instance. Algebird has instances of <code class="highlighter-rouge">Hash128</code> for many common types such as <code class="highlighter-rouge">Int</code>, <code class="highlighter-rouge">Long</code> and <code class="highlighter-rouge">String</code>.</p>

<p>To learn more about the <code class="highlighter-rouge">Array[Byte]</code> aggregators, see <a href="https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/HyperLogLog.scala">the source code of HyperLogLog</a>.</p>

<h3 id="hyperloglogaggregatorwitherrorgenerick-hash128error-double"><code class="highlighter-rouge">HyperLogLogAggregator.withErrorGeneric[K: Hash128](error: Double)</code></h3>

<p>This is an aggregator of type <code class="highlighter-rouge">Aggregator[K, HLL, HLL]</code>, which means that it builds a <code class="highlighter-rouge">HLL</code> from a <code class="highlighter-rouge">TraversableOnce</code> of <code class="highlighter-rouge">K</code>s.
It takes an <code class="highlighter-rouge">error</code>, which must be a Double in the range (0,1).</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">agg</span> <span class="k">=</span> <span class="nc">HyperLogLogAggregator</span><span class="o">.</span><span class="n">withErrorGeneric</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mf">0.01</span><span class="o">)</span>
<span class="n">agg</span><span class="k">:</span> <span class="kt">com.twitter.algebird.GenHLLAggregator</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">GenHLLAggregator</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">HyperLogLogMonoid</span><span class="k">@</span><span class="mf">51614d</span><span class="mi">68</span><span class="o">,</span><span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">Hash128$$anon$5</span><span class="k">@</span><span class="mi">3</span><span class="n">b976cd4</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">combinedHll</span><span class="k">:</span> <span class="kt">HLL</span> <span class="o">=</span> <span class="n">agg</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">combinedHll</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HLL</span> <span class="o">=</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">14</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">10388</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="mi">9650</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="mi">15708</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="mi">10082</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="mi">6205</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
</code></pre>
</div>

<h3 id="hyperloglogaggregatorwithbitsk-hash128bits-int"><code class="highlighter-rouge">HyperLogLogAggregator.withBits[K: Hash128](bits: Int)</code></h3>

<p>Similar to <code class="highlighter-rouge">withErrorGeneric</code>, but takes the number of bits as an Int.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">agg</span> <span class="k">=</span> <span class="nc">HyperLogLogAggregator</span><span class="o">.</span><span class="n">withBits</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mi">9</span><span class="o">)</span>
<span class="n">agg</span><span class="k">:</span> <span class="kt">com.twitter.algebird.GenHLLAggregator</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">GenHLLAggregator</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">HyperLogLogMonoid</span><span class="k">@</span><span class="mi">78</span><span class="n">c37d89</span><span class="o">,</span><span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">Hash128$$anon$5</span><span class="k">@</span><span class="mi">3</span><span class="n">b976cd4</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">combinedHll</span><span class="k">:</span> <span class="kt">HLL</span> <span class="o">=</span> <span class="n">agg</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">combinedHll</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HLL</span> <span class="o">=</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">9</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">348</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="mi">61</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="mi">148</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="mi">434</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="mi">354</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
</code></pre>
</div>

<h3 id="hyperloglogaggregatorsizewitherrorgenerick-hash128err-double"><code class="highlighter-rouge">HyperLogLogAggregator.sizeWithErrorGeneric[K: Hash128](err: Double)</code></h3>

<p>This is an aggregator of type <code class="highlighter-rouge">Aggregator[K, HLL, Long]</code>, which means that it presents a Long value. The Long that it returns is the estimated size of the combined HLL.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">agg</span> <span class="k">=</span> <span class="nc">HyperLogLogAggregator</span><span class="o">.</span><span class="n">sizeWithErrorGeneric</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mf">0.01</span><span class="o">)</span>
<span class="n">agg</span><span class="k">:</span> <span class="kt">com.twitter.algebird.MonoidAggregator</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">com.twitter.algebird.HLL</span>,<span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">MonoidAggregator$$anon$6</span><span class="k">@</span><span class="mi">10</span><span class="n">cdae</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">approximateSize</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="n">agg</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">approximateSize</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">5</span>
</code></pre>
</div>

<h3 id="repl-tour">REPL Tour</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">HyperLogLog._</span>
<span class="k">import</span> <span class="nn">HyperLogLog._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">hll</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HyperLogLogMonoid</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="n">hll</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HyperLogLogMonoid</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">HyperLogLogMonoid</span><span class="k">@</span><span class="mi">352</span><span class="n">b1260</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">seqHll</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">hll</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">}</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">24</span><span class="k">:</span> <span class="kt">warning:</span> <span class="kt">method</span> <span class="kt">apply</span> <span class="kt">in</span> <span class="kt">class</span> <span class="kt">HyperLogLogMonoid</span> <span class="kt">is</span> <span class="kt">deprecated:</span> <span class="kt">Use</span> <span class="kt">toHLL</span>
       <span class="k">val</span> <span class="n">seqHll</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">hll</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">}</span>
                               <span class="o">^</span>
<span class="n">seqHll</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">com.twitter.algebird.HLL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">13</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">13</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">4</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">4</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">12</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))),</span> <span class="nc">SparseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Map</span><span class="o">(</span><span class="mi">12</span> <span class="o">-&gt;</span> <span class="nc">Max</span><span class="o">(</span><span class="mi">1</span><span class="o">))))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumHll</span> <span class="k">=</span> <span class="n">hll</span><span class="o">.</span><span class="n">sum</span><span class="o">(</span><span class="n">seqHll</span><span class="o">)</span>
<span class="n">sumHll</span><span class="k">:</span> <span class="kt">com.twitter.algebird.HLL</span> <span class="o">=</span> <span class="nc">DenseHLL</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="nc">Bytes</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">approxSizeOf</span> <span class="k">=</span> <span class="n">hll</span><span class="o">.</span><span class="n">sizeOf</span><span class="o">(</span><span class="n">sumHll</span><span class="o">)</span>
<span class="n">approxSizeOf</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Approximate</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Approximate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">9</span><span class="o">,</span><span class="mf">0.9972</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">actualSize</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">toSet</span><span class="o">.</span><span class="n">size</span>
<span class="n">actualSize</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">estimate</span> <span class="k">=</span> <span class="n">approxSizeOf</span><span class="o">.</span><span class="n">estimate</span>
<span class="n">estimate</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre>
</div>

<h2 id="a-idbloom-hrefblooma-bloom-filter"><a id="bloom" href="#bloom"></a> Bloom Filter</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">NUM_HASHES</span> <span class="k">=</span> <span class="mi">6</span>
<span class="nc">NUM_HASHES</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">WIDTH</span> <span class="k">=</span> <span class="mi">32</span>
<span class="nc">WIDTH</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">SEED</span> <span class="k">=</span> <span class="mi">1</span>
<span class="nc">SEED</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">bfMonoid</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BloomFilterMonoid</span><span class="o">(</span><span class="nc">NUM_HASHES</span><span class="o">,</span> <span class="nc">WIDTH</span><span class="o">,</span> <span class="nc">SEED</span><span class="o">)</span>
<span class="n">bfMonoid</span><span class="k">:</span> <span class="kt">com.twitter.algebird.BloomFilterMonoid</span> <span class="o">=</span> <span class="nc">BloomFilterMonoid</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">32</span><span class="o">,</span><span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">bf</span> <span class="k">=</span> <span class="n">bfMonoid</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="s">"2"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"100"</span><span class="o">)</span>
<span class="n">bf</span><span class="k">:</span> <span class="kt">com.twitter.algebird.BF</span> <span class="o">=</span>
<span class="nc">BFSparse</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;,</span> <span class="nc">EWAHCompressedBitmap</span><span class="o">,</span> <span class="n">size</span> <span class="n">in</span> <span class="n">bits</span> <span class="k">=</span> <span class="mi">32</span> <span class="n">size</span> <span class="n">in</span> <span class="n">words</span> <span class="k">=</span> <span class="mi">2</span>
<span class="mi">0</span> <span class="mh">0x00</span>
<span class="mi">1</span> <span class="n">dirties</span>
<span class="o">,</span><span class="mi">32</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">approxBool</span> <span class="k">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">"1"</span><span class="o">)</span>
<span class="n">approxBool</span><span class="k">:</span> <span class="kt">com.twitter.algebird.ApproximateBoolean</span> <span class="o">=</span> <span class="nc">ApproximateBoolean</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span><span class="mf">0.9290349745708529</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">res</span> <span class="k">=</span> <span class="n">approxBool</span><span class="o">.</span><span class="n">isTrue</span>
<span class="n">res</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>
</div>

<h2 id="a-idqtree-hrefqtreea-qtree"><a id="qtree" href="#qtree"></a> QTree</h2>

<p>A <code class="highlighter-rouge">QTree[A: Monoid]</code> is like an approximate <code class="highlighter-rouge">Map[Double, A: Monoid]</code> that can store only a fixed number of keys. Instead of storing key-value pairs, it stores range-value pairs, where each range is a small Double interval, and the ranges don’t overlap. When there are too many keys, it combines nearby range-value pairs, combining the ranges, and combining the values using the <code class="highlighter-rouge">Monoid[A]</code> operation. Each range-value pair also keeps track of its count, i.e. the number of key-value pairs the range is composed of.</p>

<p>For example, suppose we create a QTree[String] from the following values: (remember that <code class="highlighter-rouge">String</code> is a <code class="highlighter-rouge">Monoid</code> under concatenation)</p>

<ul>
  <li>0.1, “he”</li>
  <li>0.2, “ll”</li>
  <li>0.21, “o”</li>
  <li>0.26, “wo”</li>
  <li>0.3, “r”</li>
  <li>0.4, “l”</li>
  <li>0.49, “d”</li>
</ul>

<p>This QTree might be represented as</p>

<ul>
  <li>[0,0.125), “he”, count=1</li>
  <li>[0.125,0.25), “llo”, count=2</li>
  <li>[0.25, 0.375), “wor”, count=2</li>
  <li>[0.375, 0.5), “ld”, count=2</li>
</ul>

<p>or as</p>

<ul>
  <li>[0, 0.25), “hello”, count=3</li>
  <li>[0.25, 0.5), “world”, count=4</li>
</ul>

<p>or as</p>

<ul>
  <li>[0,0.5), “helloworld”, count=7</li>
</ul>

<p>How is this useful?</p>

<p>The most common usage of <code class="highlighter-rouge">QTree</code> is as <code class="highlighter-rouge">QTree[Unit]</code>. (Remember, <code class="highlighter-rouge">Unit</code> is a trivial monoid, where <code class="highlighter-rouge">() + () = ()</code> and <code class="highlighter-rouge">()</code> is the identity.)</p>

<p>This is basically a histogram. Why? When two ranges get combined, the counts get added together, so at any point, the count associated with a range R is exactly the number of original Double values in that range.</p>
<ul>
  <li>The <code class="highlighter-rouge">quantileBounds</code> function gives lower and upper bounds for a given quantile.
For instance, <code class="highlighter-rouge">qtree.quantileBounds(0.5)</code> gives bounds for the median double value.</li>
  <li>The <code class="highlighter-rouge">rangeCountBounds</code> function gives lower and upper bounds for the count within a certain range.
For instance, <code class="highlighter-rouge">qtree.rangeCountBounds(0.5, 2.5)</code> gives lower and upper bounds for the number of elements in the range (0.5, 2.5).</li>
</ul>

<p>What happens if we use a nontrivial monoid <code class="highlighter-rouge">A</code>, instead of <code class="highlighter-rouge">Unit</code>? Then we get some more useful functions:</p>
<ul>
  <li><code class="highlighter-rouge">rangeSumBounds</code> gives lower and upper bounds for the monoid sum of the elements in a certain range.</li>
</ul>

<p>For example, if we call <code class="highlighter-rouge">qtree.rangeSumBounds(0.1,0.2)</code> on the first QTree described above, it would return <code class="highlighter-rouge">("","hello")</code>. Why is it a range, and not an exact value? This is because we only store the ranges and we don’t know exactly where in the range each item is. For example, <code class="highlighter-rouge">"he"</code> might exist between 0 and 0.09999 and <code class="highlighter-rouge">"llo"</code> might exist between 0.20001 and 0.25, in which case the true sum over (0.1,0.2) would be <code class="highlighter-rouge">""</code>. On the other hand, <code class="highlighter-rouge">"he"</code> might exist between 0.1 and 0.125, and <code class="highlighter-rouge">"llo"</code> might exist between 0.125 and 0.2, in which case the true sum would be <code class="highlighter-rouge">"hello"</code>. The answer could also be anywhere in between these two results. If we look at the original data points, we see that the correct answer is actually <code class="highlighter-rouge">"he"</code>, since <code class="highlighter-rouge">"he"</code> is the only value in the range [0.1,0.2).</p>

<ul>
  <li><code class="highlighter-rouge">totalSum</code> returns the total sum over the entire tree. In the example above, <code class="highlighter-rouge">qtree.totalSum</code> would return <code class="highlighter-rouge">"helloworld"</code>.</li>
</ul>

<h3 id="repl-tour-1">REPL Tour</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">seqQTree</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="nc">QTree</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">}</span>
<span class="n">seqQTree</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">com.twitter.algebird.QTree</span><span class="o">[</span><span class="kt">Long</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.QTreeSemigroup</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.QTreeSemigroup</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">qtSemigroup</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">QTreeSemigroup</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="mi">6</span><span class="o">)</span>
<span class="n">qtSemigroup</span><span class="k">:</span> <span class="kt">com.twitter.algebird.QTreeSemigroup</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">QTreeSemigroup</span><span class="k">@</span><span class="mf">54284f</span><span class="mi">4</span><span class="n">e</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sum</span> <span class="k">=</span> <span class="n">qtSemigroup</span><span class="o">.</span><span class="n">sumOption</span><span class="o">(</span><span class="n">seqQTree</span><span class="o">).</span><span class="n">get</span>
<span class="n">sum</span><span class="k">:</span> <span class="kt">com.twitter.algebird.QTree</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">14</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">12</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">7</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">14</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))))))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sum2</span> <span class="k">=</span> <span class="n">seqQTree</span><span class="o">.</span><span class="n">reduce</span><span class="o">{</span><span class="n">qtSemigroup</span><span class="o">.</span><span class="n">plus</span><span class="o">(</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)}</span>
<span class="n">sum2</span><span class="k">:</span> <span class="kt">com.twitter.algebird.QTree</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">14</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">12</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">7</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">14</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)))))))),</span><span class="nc">Some</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nc">Some</span><span class="o">((</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="nc">None</span><span class="o">,</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)),</span><span class="nc">None</span><span class="o">)))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">count</span>
<span class="n">warning</span><span class="k">:</span> <span class="kt">there</span> <span class="kt">was</span> <span class="kt">one</span> <span class="kt">inliner</span> <span class="kt">warning</span><span class="o">;</span> <span class="n">re</span><span class="o">-</span><span class="n">run</span> <span class="k">with</span> <span class="o">-</span><span class="nc">Yinline</span><span class="o">-</span><span class="n">warnings</span> <span class="k">for</span> <span class="n">details</span>
<span class="n">res2</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">upperBound</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">16.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">lowerBound</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">quantileBounds</span><span class="o">(.</span><span class="mi">5</span><span class="o">)</span>
<span class="n">res5</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="mf">5.0</span><span class="o">,</span><span class="mf">6.0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">quantileBounds</span><span class="o">(.</span><span class="mi">5</span><span class="o">)</span>
<span class="n">res6</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="mf">5.0</span><span class="o">,</span><span class="mf">6.0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">quantileBounds</span><span class="o">(.</span><span class="mi">25</span><span class="o">)</span>
<span class="n">res7</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="mf">3.0</span><span class="o">,</span><span class="mf">4.0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sum</span><span class="o">.</span><span class="n">quantileBounds</span><span class="o">(.</span><span class="mi">75</span><span class="o">)</span>
<span class="n">res8</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="mf">7.0</span><span class="o">,</span><span class="mf">8.0</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="a-idcms-hrefcmsa-count-min-sketch"><a id="cms" href="#cms"></a> Count Min Sketch</h2>

<p>Count-min sketch is a probablistic data structure that estimates the frequencies of elements in a data stream. Count-min sketches are somewhat similar to Bloom filters; the main distinction is that Bloom filters represent sets, while count-min sketches represent multisets. For more info, see <a href="https://en.wikipedia.org/wiki/Count%E2%80%93min_sketch">Wikipedia</a>.</p>

<p>In Algebird, count-min sketches are represented as the abstract class CMS, along with the CMSMonoid class.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.CMSHasherImplicits._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.CMSHasherImplicits._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">DELTA</span> <span class="k">=</span> <span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">10</span>
<span class="nc">DELTA</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.0E-10</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">EPS</span> <span class="k">=</span> <span class="mf">0.001</span>
<span class="nc">EPS</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">SEED</span> <span class="k">=</span> <span class="mi">1</span>
<span class="nc">SEED</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">HEAVY_HITTERS_PCT</span> <span class="k">=</span> <span class="mf">0.01</span>
<span class="nc">HEAVY_HITTERS_PCT</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">CMS_MONOID</span> <span class="k">=</span> <span class="nc">TopPctCMS</span><span class="o">.</span><span class="n">monoid</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="nc">EPS</span><span class="o">,</span> <span class="nc">DELTA</span><span class="o">,</span> <span class="nc">SEED</span><span class="o">,</span> <span class="nc">HEAVY_HITTERS_PCT</span><span class="o">)</span>
<span class="nc">CMS_MONOID</span><span class="k">:</span> <span class="kt">com.twitter.algebird.TopPctCMSMonoid</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">TopPctCMSMonoid</span><span class="k">@</span><span class="mi">5026</span><span class="n">cc15</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="mi">1L</span><span class="o">,</span> <span class="mi">3L</span><span class="o">,</span> <span class="mi">4L</span><span class="o">,</span> <span class="mi">5L</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">cms</span> <span class="k">=</span> <span class="nc">CMS_MONOID</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">cms</span><span class="k">:</span> <span class="kt">com.twitter.algebird.TopCMS</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TopCMSInstance</span><span class="o">(</span><span class="nc">SparseCMS</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">),</span><span class="mi">5</span><span class="o">,</span><span class="nc">CMSParams</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">1155869325</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">431529176</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">1761283695</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">1749940626</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">892128508</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">155629808</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">1429008869</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">1465154083</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">138487339</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">1242363800</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">26273138</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">655996946</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">155886662</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">685382526</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">258276172</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">1915244828</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">226796111</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">382464772</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">270230103</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">2092024379</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">1705850753</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(-</span><span class="mi">369526632</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">1492578621</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">),</span> <span class="nc">CMSHash</span><span class="o">(</span><span class="mi">684358198</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2719</span><span class="o">)),</span><span class="mf">0.001</span><span class="o">,</span><span class="mf">1.</span><span class="o">...</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">cms</span><span class="o">.</span><span class="n">totalCount</span>
<span class="n">res9</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">cms</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="n">estimate</span>
<span class="n">res10</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">cms</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="mi">2L</span><span class="o">).</span><span class="n">estimate</span>
<span class="n">res11</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">cms</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="mi">3L</span><span class="o">).</span><span class="n">estimate</span>
<span class="n">res12</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre>
</div>

<h2 id="a-idvalue-hrefvaluea-decayed-value-aka-moving-average"><a id="value" href="#value"></a> Decayed Value (aka. moving average)</h2>

<p>A DecayedValue can be approximately computed into a moving average. Please see an explanation of different averages here: <a href="http://donlehmanjr.com/Science/03%20Decay%20Ave/032.htm">The Decaying Average</a>.</p>

<p>@johnynek mentioned that:</p>

<blockquote>
  <p>a DecayedValue is approximately like a moving average value with window size of the half-life. It is EXACTLY a sample of the Laplace transform of the signal of values. Therefore, if we normalize a decayed value with halflife/ln(2), which is the integral of exp(-t(ln(2))/halflife) from 0 to infinity. We get a moving average of the window size equal to halflife.</p>
</blockquote>

<p>See the related issue: https://github.com/twitter/algebird/issues/235</p>

<p>Here is the code example for computing a DecayedValue average:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="n">rnd</span> <span class="k">=</span> <span class="k">new</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span>
     <span class="o">|</span>   <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">100</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">rnd</span><span class="o">.</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">1000</span><span class="o">).</span><span class="n">toDouble</span> <span class="o">}.</span><span class="n">toSeq</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Seq</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Vector</span><span class="o">(</span><span class="mf">259.0</span><span class="o">,</span> <span class="mf">617.0</span><span class="o">,</span> <span class="mf">681.0</span><span class="o">,</span> <span class="mf">87.0</span><span class="o">,</span> <span class="mf">512.0</span><span class="o">,</span> <span class="mf">507.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">462.0</span><span class="o">,</span> <span class="mf">140.0</span><span class="o">,</span> <span class="mf">348.0</span><span class="o">,</span> <span class="mf">963.0</span><span class="o">,</span> <span class="mf">463.0</span><span class="o">,</span> <span class="mf">41.0</span><span class="o">,</span> <span class="mf">252.0</span><span class="o">,</span> <span class="mf">905.0</span><span class="o">,</span> <span class="mf">642.0</span><span class="o">,</span> <span class="mf">189.0</span><span class="o">,</span> <span class="mf">595.0</span><span class="o">,</span> <span class="mf">41.0</span><span class="o">,</span> <span class="mf">701.0</span><span class="o">,</span> <span class="mf">304.0</span><span class="o">,</span> <span class="mf">516.0</span><span class="o">,</span> <span class="mf">241.0</span><span class="o">,</span> <span class="mf">925.0</span><span class="o">,</span> <span class="mf">386.0</span><span class="o">,</span> <span class="mf">683.0</span><span class="o">,</span> <span class="mf">98.0</span><span class="o">,</span> <span class="mf">910.0</span><span class="o">,</span> <span class="mf">258.0</span><span class="o">,</span> <span class="mf">764.0</span><span class="o">,</span> <span class="mf">986.0</span><span class="o">,</span> <span class="mf">674.0</span><span class="o">,</span> <span class="mf">41.0</span><span class="o">,</span> <span class="mf">306.0</span><span class="o">,</span> <span class="mf">534.0</span><span class="o">,</span> <span class="mf">402.0</span><span class="o">,</span> <span class="mf">980.0</span><span class="o">,</span> <span class="mf">120.0</span><span class="o">,</span> <span class="mf">796.0</span><span class="o">,</span> <span class="mf">659.0</span><span class="o">,</span> <span class="mf">208.0</span><span class="o">,</span> <span class="mf">807.0</span><span class="o">,</span> <span class="mf">734.0</span><span class="o">,</span> <span class="mf">23.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">21.0</span><span class="o">,</span> <span class="mf">571.0</span><span class="o">,</span> <span class="mf">327.0</span><span class="o">,</span> <span class="mf">434.0</span><span class="o">,</span> <span class="mf">230.0</span><span class="o">,</span> <span class="mf">727.0</span><span class="o">,</span> <span class="mf">763.0</span><span class="o">,</span> <span class="mf">33.0</span><span class="o">,</span> <span class="mf">514.0</span><span class="o">,</span> <span class="mf">443.0</span><span class="o">,</span> <span class="mf">422.0</span><span class="o">,</span> <span class="mf">579.0</span><span class="o">,</span> <span class="mf">171.0</span><span class="o">,</span> <span class="mf">655.0</span><span class="o">,</span> <span class="mf">752.0</span><span class="o">,</span> <span class="mf">890.0</span><span class="o">,</span> <span class="mf">745.0</span><span class="o">,</span> <span class="mf">972.0</span><span class="o">,</span> <span class="mf">761.0</span><span class="o">,</span> <span class="mf">887.0</span><span class="o">,</span> <span class="mf">347.0</span><span class="o">,</span> <span class="mf">422.0</span><span class="o">,</span> <span class="mf">367.0</span><span class="o">,</span> <span class="mf">170.0</span><span class="o">,</span> <span class="mf">140.0</span><span class="o">,</span> <span class="mf">398.0</span><span class="o">,</span> <span class="mf">877.0</span><span class="o">,</span> <span class="mf">38.0</span><span class="o">,</span> <span class="mf">344.0</span><span class="o">,</span> <span class="mf">638.0</span><span class="o">,</span> <span class="mf">776.0</span><span class="o">,</span> <span class="mf">602.0</span><span class="o">,</span> <span class="mf">690.0</span><span class="o">,</span> <span class="mf">638.0</span><span class="o">,</span> <span class="mf">526.0</span><span class="o">,</span> <span class="mf">603.0</span><span class="o">,</span> <span class="mf">459.0</span><span class="o">,</span> <span class="mf">436.0</span><span class="o">,</span> <span class="mf">525.0</span><span class="o">,</span> <span class="mf">596.0</span><span class="o">,</span> <span class="mf">257.0</span><span class="o">,</span> <span class="mf">967.0</span><span class="o">,</span> <span class="mf">982.0</span><span class="o">,</span> <span class="mf">64.0</span><span class="o">,</span> <span class="mf">770.0</span><span class="o">,</span> <span class="mf">36.0</span><span class="o">,</span> <span class="mf">196.0</span><span class="o">,</span> <span class="mf">134.0</span><span class="o">,</span> <span class="mf">547.0</span><span class="o">,</span> <span class="mf">993.0</span><span class="o">,</span> <span class="mf">541.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">263.0</span><span class="o">,</span> <span class="mf">364.0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">HalfLife</span> <span class="k">=</span> <span class="mf">10.0</span>
<span class="nc">HalfLife</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">normalization</span> <span class="k">=</span> <span class="nc">HalfLife</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="n">normalization</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">14.426950408889635</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">implicit</span> <span class="k">val</span> <span class="n">dvMonoid</span> <span class="k">=</span> <span class="nc">DecayedValue</span><span class="o">.</span><span class="n">monoidWithEpsilon</span><span class="o">(</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">3</span><span class="o">)</span>
<span class="n">dvMonoid</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Monoid</span><span class="o">[</span><span class="kt">com.twitter.algebird.DecayedValue</span><span class="o">]</span> <span class="k">=</span> <span class="nc">DecayedValueMonoid</span><span class="o">(</span><span class="mf">0.001</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">scanLeft</span><span class="o">(</span><span class="nc">Monoid</span><span class="o">.</span><span class="n">zero</span><span class="o">[</span><span class="kt">DecayedValue</span><span class="o">])</span> <span class="o">{</span> <span class="o">(</span><span class="n">previous</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="k">=&gt;</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">time</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="n">decayed</span> <span class="k">=</span> <span class="nc">Monoid</span><span class="o">.</span><span class="n">plus</span><span class="o">(</span><span class="n">previous</span><span class="o">,</span> <span class="nc">DecayedValue</span><span class="o">.</span><span class="n">build</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">time</span><span class="o">,</span> <span class="nc">HalfLife</span><span class="o">))</span>
     <span class="o">|</span>   <span class="n">println</span><span class="o">(</span><span class="s">"At %d: decayed=%f"</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="n">time</span><span class="o">,</span> <span class="o">(</span><span class="n">decayed</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">normalization</span><span class="o">)))</span>
     <span class="o">|</span>   <span class="n">decayed</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="nc">At</span> <span class="mi">0</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">17.952512</span>
<span class="nc">At</span> <span class="mi">1</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">59.517467</span>
<span class="nc">At</span> <span class="mi">2</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">102.735083</span>
<span class="nc">At</span> <span class="mi">3</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">101.885603</span>
<span class="nc">At</span> <span class="mi">4</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">130.551764</span>
<span class="nc">At</span> <span class="mi">5</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">156.951665</span>
<span class="nc">At</span> <span class="mi">6</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">146.579711</span>
<span class="nc">At</span> <span class="mi">7</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">168.787106</span>
<span class="nc">At</span> <span class="mi">8</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">167.187999</span>
<span class="nc">At</span> <span class="mi">9</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">180.113441</span>
<span class="nc">At</span> <span class="mi">10</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">234.801856</span>
<span class="nc">At</span> <span class="mi">11</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">251.170593</span>
<span class="nc">At</span> <span class="mi">12</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">237.192353</span>
<span class="nc">At</span> <span class="mi">13</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">238.775599</span>
<span class="nc">At</span> <span class="mi">14</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">285.515332</span>
<span class="nc">At</span> <span class="mi">15</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">310.895273</span>
<span class="nc">At</span> <span class="mi">16</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">303.176028</span>
<span class="nc">At</span> <span class="mi">17</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">324.115494</span>
<span class="nc">At</span> <span class="mi">18</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">305.252352</span>
<span class="nc">At</span> <span class="mi">19</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">333.400133</span>
<span class="nc">At</span> <span class="mi">20</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">332.144998</span>
<span class="nc">At</span> <span class="mi">21</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">345.668635</span>
<span class="nc">At</span> <span class="mi">22</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">339.225088</span>
<span class="nc">At</span> <span class="mi">23</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">380.624313</span>
<span class="nc">At</span> <span class="mi">24</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">381.890522</span>
<span class="nc">At</span> <span class="mi">25</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">403.658409</span>
<span class="nc">At</span> <span class="mi">26</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">383.419455</span>
<span class="nc">At</span> <span class="mi">27</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">420.819395</span>
<span class="nc">At</span> <span class="mi">28</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">410.521576</span>
<span class="nc">At</span> <span class="mi">29</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">435.986619</span>
<span class="nc">At</span> <span class="mi">30</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">475.134211</span>
<span class="nc">At</span> <span class="mi">31</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">490.034014</span>
<span class="nc">At</span> <span class="mi">32</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">460.059806</span>
<span class="nc">At</span> <span class="mi">33</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">450.461281</span>
<span class="nc">At</span> <span class="mi">34</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">457.309296</span>
<span class="nc">At</span> <span class="mi">35</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">454.549177</span>
<span class="nc">At</span> <span class="mi">36</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">492.037802</span>
<span class="nc">At</span> <span class="mi">37</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">467.405269</span>
<span class="nc">At</span> <span class="mi">38</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">491.279052</span>
<span class="nc">At</span> <span class="mi">39</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">504.057962</span>
<span class="nc">At</span> <span class="mi">40</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">484.720170</span>
<span class="nc">At</span> <span class="mi">41</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">508.196888</span>
<span class="nc">At</span> <span class="mi">42</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">525.041465</span>
<span class="nc">At</span> <span class="mi">43</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">491.475248</span>
<span class="nc">At</span> <span class="mi">44</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">458.562621</span>
<span class="nc">At</span> <span class="mi">45</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">429.309663</span>
<span class="nc">At</span> <span class="mi">46</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">440.138783</span>
<span class="nc">At</span> <span class="mi">47</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">433.329918</span>
<span class="nc">At</span> <span class="mi">48</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">434.393698</span>
<span class="nc">At</span> <span class="mi">49</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">421.246036</span>
<span class="nc">At</span> <span class="mi">50</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">443.428249</span>
<span class="nc">At</span> <span class="mi">51</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">466.620316</span>
<span class="nc">At</span> <span class="mi">52</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">437.659535</span>
<span class="nc">At</span> <span class="mi">53</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">443.978550</span>
<span class="nc">At</span> <span class="mi">54</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">444.953055</span>
<span class="nc">At</span> <span class="mi">55</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">444.406691</span>
<span class="nc">At</span> <span class="mi">56</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">454.779326</span>
<span class="nc">At</span> <span class="mi">57</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">436.176932</span>
<span class="nc">At</span> <span class="mi">58</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">452.368608</span>
<span class="nc">At</span> <span class="mi">59</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">474.199504</span>
<span class="nc">At</span> <span class="mi">60</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">504.133880</span>
<span class="nc">At</span> <span class="mi">61</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">522.013008</span>
<span class="nc">At</span> <span class="mi">62</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">554.429264</span>
<span class="nc">At</span> <span class="mi">63</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">570.049295</span>
<span class="nc">At</span> <span class="mi">64</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">593.356954</span>
<span class="nc">At</span> <span class="mi">65</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">577.673821</span>
<span class="nc">At</span> <span class="mi">66</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">568.239545</span>
<span class="nc">At</span> <span class="mi">67</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">555.624744</span>
<span class="nc">At</span> <span class="mi">68</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">530.199719</span>
<span class="nc">At</span> <span class="mi">69</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">504.397890</span>
<span class="nc">At</span> <span class="mi">70</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">498.207130</span>
<span class="nc">At</span> <span class="mi">71</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">525.632697</span>
<span class="nc">At</span> <span class="mi">72</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">493.066607</span>
<span class="nc">At</span> <span class="mi">73</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">483.891674</span>
<span class="nc">At</span> <span class="mi">74</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">495.709687</span>
<span class="nc">At</span> <span class="mi">75</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">516.301713</span>
<span class="nc">At</span> <span class="mi">76</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">523.453992</span>
<span class="nc">At</span> <span class="mi">77</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">536.227000</span>
<span class="nc">At</span> <span class="mi">78</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">544.540272</span>
<span class="nc">At</span> <span class="mi">79</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">544.533580</span>
<span class="nc">At</span> <span class="mi">80</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">549.864571</span>
<span class="nc">At</span> <span class="mi">81</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">544.857241</span>
<span class="nc">At</span> <span class="mi">82</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">538.590998</span>
<span class="nc">At</span> <span class="mi">83</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">538.913397</span>
<span class="nc">At</span> <span class="mi">84</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">544.135551</span>
<span class="nc">At</span> <span class="mi">85</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">525.510304</span>
<span class="nc">At</span> <span class="mi">86</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">557.345783</span>
<span class="nc">At</span> <span class="mi">87</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">588.089057</span>
<span class="nc">At</span> <span class="mi">88</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">553.142634</span>
<span class="nc">At</span> <span class="mi">89</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">569.472659</span>
<span class="nc">At</span> <span class="mi">90</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">533.832109</span>
<span class="nc">At</span> <span class="mi">91</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">511.668654</span>
<span class="nc">At</span> <span class="mi">92</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">486.691907</span>
<span class="nc">At</span> <span class="mi">93</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">492.014757</span>
<span class="nc">At</span> <span class="mi">94</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">527.895516</span>
<span class="nc">At</span> <span class="mi">95</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">530.043195</span>
<span class="nc">At</span> <span class="mi">96</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">495.240935</span>
<span class="nc">At</span> <span class="mi">97</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">462.699963</span>
<span class="nc">At</span> <span class="mi">98</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">449.944102</span>
<span class="nc">At</span> <span class="mi">99</span><span class="k">:</span> <span class="kt">decayed</span><span class="o">=</span><span class="mf">445.043249</span>
<span class="n">res13</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Seq</span><span class="o">[</span><span class="kt">com.twitter.algebird.DecayedValue</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Vector</span><span class="o">(</span><span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,-</span><span class="nc">Infinity</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">259.0</span><span class="o">,</span><span class="mf">0.0</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">858.6555448080331</span><span class="o">,</span><span class="mf">0.06931471805599453</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">1482.1539516719063</span><span class="o">,</span><span class="mf">0.13862943611198905</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">1469.8985354465394</span><span class="o">,</span><span class="mf">0.20794415416798356</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">1883.4638277832566</span><span class="o">,</span><span class="mf">0.2772588722239781</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">2264.333889687978</span><span class="o">,</span><span class="mf">0.34657359027997264</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">2114.6982229337495</span><span class="o">,</span><span class="mf">0.4158883083359671</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">2435.083209141447</span><span class="o">,</span><span class="mf">0.48520302639196167</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">2412.0129712662933</span><span class="o">,</span><span class="mf">0.5545177444479562</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">2598.4876782061733</span><span class="o">,</span><span class="mf">0.6238324625039507</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">3387.474731868239</span><span class="o">,</span><span class="mf">0.6931471805599453</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">3623.6256828303676</span><span class="o">,</span><span class="mf">0.7624618986159398</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">3421.962311060825</span><span class="o">,</span><span class="mf">0.8317766166719343</span><span class="o">),</span> <span class="nc">DecayedValue</span><span class="o">(</span><span class="mf">3444.8037320</span><span class="o">...</span>
</code></pre>
</div>

<p>Running the above code in comparison with a simple decayed average:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">scanLeft</span><span class="o">(</span><span class="mf">0.0</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">previous</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="k">=&gt;</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">time</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="n">avg</span> <span class="k">=</span> <span class="o">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">previous</span> <span class="o">*</span> <span class="o">(</span><span class="nc">HalfLife</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">))</span> <span class="o">/</span> <span class="nc">HalfLife</span>
     <span class="o">|</span>   <span class="n">println</span><span class="o">(</span><span class="s">"At %d: windowed=%f"</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="n">time</span><span class="o">,</span> <span class="n">avg</span><span class="o">))</span>
     <span class="o">|</span>   <span class="n">avg</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="nc">At</span> <span class="mi">0</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">25.900000</span>
<span class="nc">At</span> <span class="mi">1</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">85.010000</span>
<span class="nc">At</span> <span class="mi">2</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">144.609000</span>
<span class="nc">At</span> <span class="mi">3</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">138.848100</span>
<span class="nc">At</span> <span class="mi">4</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">176.163290</span>
<span class="nc">At</span> <span class="mi">5</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">209.246961</span>
<span class="nc">At</span> <span class="mi">6</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">188.522265</span>
<span class="nc">At</span> <span class="mi">7</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">215.870038</span>
<span class="nc">At</span> <span class="mi">8</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">208.283035</span>
<span class="nc">At</span> <span class="mi">9</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">222.254731</span>
<span class="nc">At</span> <span class="mi">10</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">296.329258</span>
<span class="nc">At</span> <span class="mi">11</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">312.996332</span>
<span class="nc">At</span> <span class="mi">12</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">285.796699</span>
<span class="nc">At</span> <span class="mi">13</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">282.417029</span>
<span class="nc">At</span> <span class="mi">14</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">344.675326</span>
<span class="nc">At</span> <span class="mi">15</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">374.407794</span>
<span class="nc">At</span> <span class="mi">16</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">355.867014</span>
<span class="nc">At</span> <span class="mi">17</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">379.780313</span>
<span class="nc">At</span> <span class="mi">18</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">345.902282</span>
<span class="nc">At</span> <span class="mi">19</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">381.412053</span>
<span class="nc">At</span> <span class="mi">20</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">373.670848</span>
<span class="nc">At</span> <span class="mi">21</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">387.903763</span>
<span class="nc">At</span> <span class="mi">22</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">373.213387</span>
<span class="nc">At</span> <span class="mi">23</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">428.392048</span>
<span class="nc">At</span> <span class="mi">24</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">424.152843</span>
<span class="nc">At</span> <span class="mi">25</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">450.037559</span>
<span class="nc">At</span> <span class="mi">26</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">414.833803</span>
<span class="nc">At</span> <span class="mi">27</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">464.350423</span>
<span class="nc">At</span> <span class="mi">28</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">443.715381</span>
<span class="nc">At</span> <span class="mi">29</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">475.743842</span>
<span class="nc">At</span> <span class="mi">30</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">526.769458</span>
<span class="nc">At</span> <span class="mi">31</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">541.492512</span>
<span class="nc">At</span> <span class="mi">32</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">491.443261</span>
<span class="nc">At</span> <span class="mi">33</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">472.898935</span>
<span class="nc">At</span> <span class="mi">34</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">479.009042</span>
<span class="nc">At</span> <span class="mi">35</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">471.308137</span>
<span class="nc">At</span> <span class="mi">36</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">522.177324</span>
<span class="nc">At</span> <span class="mi">37</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">481.959591</span>
<span class="nc">At</span> <span class="mi">38</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">513.363632</span>
<span class="nc">At</span> <span class="mi">39</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">527.927269</span>
<span class="nc">At</span> <span class="mi">40</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">495.934542</span>
<span class="nc">At</span> <span class="mi">41</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">527.041088</span>
<span class="nc">At</span> <span class="mi">42</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">547.736979</span>
<span class="nc">At</span> <span class="mi">43</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">495.263281</span>
<span class="nc">At</span> <span class="mi">44</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">445.736953</span>
<span class="nc">At</span> <span class="mi">45</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">403.263258</span>
<span class="nc">At</span> <span class="mi">46</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">420.036932</span>
<span class="nc">At</span> <span class="mi">47</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">410.733239</span>
<span class="nc">At</span> <span class="mi">48</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">413.059915</span>
<span class="nc">At</span> <span class="mi">49</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">394.753923</span>
<span class="nc">At</span> <span class="mi">50</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">427.978531</span>
<span class="nc">At</span> <span class="mi">51</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">461.480678</span>
<span class="nc">At</span> <span class="mi">52</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">418.632610</span>
<span class="nc">At</span> <span class="mi">53</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">428.169349</span>
<span class="nc">At</span> <span class="mi">54</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">429.652414</span>
<span class="nc">At</span> <span class="mi">55</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">428.887173</span>
<span class="nc">At</span> <span class="mi">56</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">443.898456</span>
<span class="nc">At</span> <span class="mi">57</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">416.608610</span>
<span class="nc">At</span> <span class="mi">58</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">440.447749</span>
<span class="nc">At</span> <span class="mi">59</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">471.602974</span>
<span class="nc">At</span> <span class="mi">60</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">513.442677</span>
<span class="nc">At</span> <span class="mi">61</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">536.598409</span>
<span class="nc">At</span> <span class="mi">62</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">580.138568</span>
<span class="nc">At</span> <span class="mi">63</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">598.224711</span>
<span class="nc">At</span> <span class="mi">64</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">627.102240</span>
<span class="nc">At</span> <span class="mi">65</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">599.092016</span>
<span class="nc">At</span> <span class="mi">66</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">581.382815</span>
<span class="nc">At</span> <span class="mi">67</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">559.944533</span>
<span class="nc">At</span> <span class="mi">68</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">520.950080</span>
<span class="nc">At</span> <span class="mi">69</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">482.855072</span>
<span class="nc">At</span> <span class="mi">70</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">474.369565</span>
<span class="nc">At</span> <span class="mi">71</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">514.632608</span>
<span class="nc">At</span> <span class="mi">72</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">466.969347</span>
<span class="nc">At</span> <span class="mi">73</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">454.672413</span>
<span class="nc">At</span> <span class="mi">74</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">473.005171</span>
<span class="nc">At</span> <span class="mi">75</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">503.304654</span>
<span class="nc">At</span> <span class="mi">76</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">513.174189</span>
<span class="nc">At</span> <span class="mi">77</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">530.856770</span>
<span class="nc">At</span> <span class="mi">78</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">541.571093</span>
<span class="nc">At</span> <span class="mi">79</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">540.013984</span>
<span class="nc">At</span> <span class="mi">80</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">546.312585</span>
<span class="nc">At</span> <span class="mi">81</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">537.581327</span>
<span class="nc">At</span> <span class="mi">82</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">527.423194</span>
<span class="nc">At</span> <span class="mi">83</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">527.180875</span>
<span class="nc">At</span> <span class="mi">84</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">534.062787</span>
<span class="nc">At</span> <span class="mi">85</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">506.356508</span>
<span class="nc">At</span> <span class="mi">86</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">552.420858</span>
<span class="nc">At</span> <span class="mi">87</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">595.378772</span>
<span class="nc">At</span> <span class="mi">88</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">542.240895</span>
<span class="nc">At</span> <span class="mi">89</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">565.016805</span>
<span class="nc">At</span> <span class="mi">90</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">512.115125</span>
<span class="nc">At</span> <span class="mi">91</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">480.503612</span>
<span class="nc">At</span> <span class="mi">92</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">445.853251</span>
<span class="nc">At</span> <span class="mi">93</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">455.967926</span>
<span class="nc">At</span> <span class="mi">94</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">509.671133</span>
<span class="nc">At</span> <span class="mi">95</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">512.804020</span>
<span class="nc">At</span> <span class="mi">96</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">462.523618</span>
<span class="nc">At</span> <span class="mi">97</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">417.171256</span>
<span class="nc">At</span> <span class="mi">98</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">401.754131</span>
<span class="nc">At</span> <span class="mi">99</span><span class="k">:</span> <span class="kt">windowed</span><span class="o">=</span><span class="mf">397.978718</span>
<span class="n">res14</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Seq</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Vector</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">25.9</span><span class="o">,</span> <span class="mf">85.01</span><span class="o">,</span> <span class="mf">144.609</span><span class="o">,</span> <span class="mf">138.8481</span><span class="o">,</span> <span class="mf">176.16329</span><span class="o">,</span> <span class="mf">209.246961</span><span class="o">,</span> <span class="mf">188.5222649</span><span class="o">,</span> <span class="mf">215.87003841</span><span class="o">,</span> <span class="mf">208.28303456900002</span><span class="o">,</span> <span class="mf">222.25473111210005</span><span class="o">,</span> <span class="mf">296.32925800089004</span><span class="o">,</span> <span class="mf">312.996332200801</span><span class="o">,</span> <span class="mf">285.7966989807209</span><span class="o">,</span> <span class="mf">282.4170290826488</span><span class="o">,</span> <span class="mf">344.67532617438394</span><span class="o">,</span> <span class="mf">374.40779355694553</span><span class="o">,</span> <span class="mf">355.867014201251</span><span class="o">,</span> <span class="mf">379.7803127811259</span><span class="o">,</span> <span class="mf">345.9022815030133</span><span class="o">,</span> <span class="mf">381.41205335271195</span><span class="o">,</span> <span class="mf">373.6708480174408</span><span class="o">,</span> <span class="mf">387.9037632156967</span><span class="o">,</span> <span class="mf">373.21338689412704</span><span class="o">,</span> <span class="mf">428.39204820471434</span><span class="o">,</span> <span class="mf">424.1528433842429</span><span class="o">,</span> <span class="mf">450.03755904581857</span><span class="o">,</span> <span class="mf">414.8338031412367</span><span class="o">,</span> <span class="mf">464.350422827113</span><span class="o">,</span> <span class="mf">443.7153805444017</span><span class="o">,</span> <span class="mf">475.7438424899616</span><span class="o">,</span> <span class="mf">526.7694582409655</span><span class="o">,</span> <span class="mf">541.492512416869</span><span class="o">,</span> <span class="mf">491.4432611751821</span><span class="o">,</span> <span class="mf">472.89893505766383</span><span class="o">,</span> <span class="mf">479.00904155189744</span><span class="o">,</span> <span class="mf">471.30813739670765</span><span class="o">,</span> <span class="mf">522.1773236570368</span><span class="o">,</span> <span class="mf">481.95959129133314</span><span class="o">,</span> <span class="mf">513.3636321621998</span><span class="o">,</span> <span class="mf">527.9272689459798</span><span class="o">,</span> <span class="mf">495.93454205138175</span><span class="o">,</span> <span class="mf">527.0410878462436</span><span class="o">,...</span>
</code></pre>
</div>

<p>You will see that the averages are pretty close to each other.</p>

<h3 id="decayedvalue-faq">DecayedValue FAQ</h3>

<h4 id="is-a-decayedvalue-average-better-than-a-moving-average">Is a DecayedValue average better than a moving average?</h4>

<p>DecayedValue gives an exponential moving average. A standard windowed moving average of N points requires O(N) memory. An exponential moving average takes O(1) memory. That’s the win. Usually one, or a few, exponential moving averages gives you what you need cheaper than the naive approach of keeping 100 or 1000 recent points.</p>

<h4 id="is-a-decayedvalue-average-better-than-a-simple-decayed-average">Is a DecayedValue average better than a simple decayed average?</h4>

<p>A simple decayed average looks like this: <code class="highlighter-rouge">val avg = (value + previousAvg * (HaflLife - 1.0)) / HalfLife</code></p>

<p>In a way, a DecayedValue average is a simple decayed average with different scaling factor.</p>

<h2 id="a-idmap-hrefmapa-sketch-map"><a id="map" href="#map"></a> Sketch Map</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">DELTA</span> <span class="k">=</span> <span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">8</span>
<span class="nc">DELTA</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.0E-8</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">EPS</span> <span class="k">=</span> <span class="mf">0.001</span>
<span class="nc">EPS</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">SEED</span> <span class="k">=</span> <span class="mi">1</span>
<span class="nc">SEED</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">HEAVY_HITTERS_COUNT</span> <span class="k">=</span> <span class="mi">10</span>
<span class="nc">HEAVY_HITTERS_COUNT</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">string2Bytes</span><span class="o">(</span><span class="n">i</span> <span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">i</span><span class="o">.</span><span class="n">toCharArray</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toByte</span><span class="o">)</span>
<span class="n">string2Bytes</span><span class="k">:</span> <span class="o">(</span><span class="kt">i:</span> <span class="kt">String</span><span class="o">)</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">PARAMS</span> <span class="k">=</span> <span class="nc">SketchMapParams</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="nc">SEED</span><span class="o">,</span> <span class="nc">EPS</span><span class="o">,</span> <span class="nc">DELTA</span><span class="o">,</span> <span class="nc">HEAVY_HITTERS_COUNT</span><span class="o">)</span>
<span class="nc">PARAMS</span><span class="k">:</span> <span class="kt">com.twitter.algebird.SketchMapParams</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">SketchMapParams</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2719</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">10</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nc">MONOID</span> <span class="k">=</span> <span class="nc">SketchMap</span><span class="o">.</span><span class="n">monoid</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">](</span><span class="nc">PARAMS</span><span class="o">)</span>
<span class="nc">MONOID</span><span class="k">:</span> <span class="kt">com.twitter.algebird.SketchMapMonoid</span><span class="o">[</span><span class="kt">String</span>,<span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">algebird</span><span class="o">.</span><span class="nc">SketchMapMonoid</span><span class="k">@</span><span class="mf">4f</span><span class="mi">89928</span><span class="n">b</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">),</span> <span class="o">(</span><span class="s">"3"</span><span class="o">,</span> <span class="mi">2L</span><span class="o">),</span> <span class="o">(</span><span class="s">"4"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">),</span> <span class="o">(</span><span class="s">"5"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span> <span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sm</span> <span class="k">=</span> <span class="nc">MONOID</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">sm</span><span class="k">:</span> <span class="kt">com.twitter.algebird.SketchMap</span><span class="o">[</span><span class="kt">String</span>,<span class="kt">Long</span><span class="o">]</span> <span class="k">=</span>
<span class="nc">SketchMap</span><span class="o">(</span><span class="nc">Row</span><span class="k">:</span> <span class="err">19</span><span class="o">,</span> <span class="nc">Cols</span><span class="k">:</span> <span class="err">2719</span><span class="kt">.</span> <span class="kt">Dense</span> <span class="kt">elements:</span>
<span class="kt">List</span><span class="o">((</span><span class="err">282</span><span class="o">,</span><span class="err">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">763</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">2172</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2523</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">112</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">364</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">923</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2433</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">1615</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1652</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1794</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">2357</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">497</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1687</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2288</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2395</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">1115</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1252</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1441</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1798</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">309</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">556</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">944</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2580</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">474</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">570</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1073</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2271</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">194</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1101</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1420</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2296</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">505</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1943</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1949</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2047</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">1062</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1646</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1840</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2139</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">549</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">820</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1468</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1547</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">837</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1064</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1941</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2305</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">338</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">482</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1331</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">2285</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">158</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1010</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1244</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1725</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">90</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">606</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1464</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1474</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span>
<span class="nc">List</span><span class="o">((</span><span class="mi">143</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">768</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">935</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1340</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span>
<span class="nc">List</span><span class="o">(...</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">totalValue</span>
<span class="n">res15</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">MONOID</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="n">sm</span><span class="o">,</span> <span class="s">"1"</span><span class="o">)</span>
<span class="n">res16</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">MONOID</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="n">sm</span><span class="o">,</span> <span class="s">"2"</span><span class="o">)</span>
<span class="n">res17</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">MONOID</span><span class="o">.</span><span class="n">frequency</span><span class="o">(</span><span class="n">sm</span><span class="o">,</span> <span class="s">"3"</span><span class="o">)</span>
<span class="n">res18</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre>
</div>

<h2 id="a-idmin-hrefmina-min"><a id="min" href="#min"></a> Min</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span>
<span class="n">res19</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Min</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span>
<span class="n">res20</span><span class="k">:</span> <span class="kt">com.twitter.algebird.Min</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Min</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="a-idgeneral-hrefgenerala-general---adding-and-multiplication-of-collections"><a id="general" href="#general"></a> General - Adding and Multiplication of collections</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data2</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">data2</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data1</span> <span class="k">=</span>  <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">data1</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">data1</span> <span class="o">+</span> <span class="n">data2</span>
<span class="n">res21</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>
<span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">data1</span> <span class="o">+</span> <span class="n">data2</span>
<span class="n">res22</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">data1</span> <span class="o">*</span> <span class="n">data2</span>
<span class="n">res23</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">)</span>
<span class="n">res24</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="nc">List</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">)</span>
<span class="n">res25</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">)</span>
<span class="n">res26</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="o">+</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span>
<span class="n">res27</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">scala.collection.immutable.Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span>
</code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/scala.min.js"></script><script src="/algebird/js/main.js"></script></body></html>